{% extends "base.html" %}
{% block content %}
{% include "navbar.html" %}
    <section class="h-auto">
        <div class="page-wrapper">
            <div class="back">
                <span>
                    <svg width="20" height="12" viewBox="0 0 20 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0.469698 5.46967C0.176806 5.76256 0.176806 6.23744 0.469698 6.53033L5.24267 11.3033C5.53556 11.5962 6.01044 11.5962 6.30333 11.3033C6.59622 11.0104 6.59622 10.5355 6.30333 10.2426L2.06069 6L6.30333 1.75736C6.59622 1.46447 6.59622 0.989593 6.30333 0.696699C6.01044 0.403806 5.53556 0.403806 5.24267 0.696699L0.469698 5.46967ZM39.03 5.25L1.00003 5.25V6.75L39.03 6.75V5.25Z" fill="#3DBECF"/>
                    </svg>
                    back
                </span>
            </div>
        </div>
    </section>
    <div>
        <h3>Permissions Page</h3>
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="notification is-danger">
                    {{ messages[0] }}
                </div>
            {% endif %}
        {% endwith %}
        <a href="#" 
            data-toggle="modal" 
            data-target="#newPermission"
        >
            <span class="badge badge-warning">New Permission</span>
        </a>
        <div class="table-container">
            <form action="{{ url_for('auth.checkPerm') }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Permission Name</th>
                            {% for role in roles %}
                                <th name="role" value={{role.id}} scope="col">{{ role.title }}</th>
                            {% endfor %}
                            <th scope="col">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for permission in permissions %}
                            <tr>
                                <th name="permission" value={{permission.id}} scope="row">{{ permission.name }}</th>
                                {% for role in roles %}
                                <td>
                                    <input 
                                        id="task-{{permission.id}}" 
                                        class="check-task-button" 
                                        type="checkbox" 
                                        name="check" 
                                        {% for x in access %}
                                            {% if x == (permission.id, role.id) %} 
                                            CHECKED 
                                            {% endif %}
                                        {% endfor %}
                                        value="{{ permission.id }}-{{ role.id }}"
                                    />
                                </td>
                                {% endfor %}
                                <td>
                                    <i class="fa fa-edit"></i>
                                    <i class="fa fa-trash"></i>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <button class="button is-block is-info is-large is-fullwidth">Save</button>
            </form>
        </div>

        <div class="modal fade" id="newPermission" tabindex="1" role="dialog" aria-labelledby="userPermission" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title" id="userPermission">{{ title }}</h4>
                    </div>
                    <div class="modal-body">
                        <form method="POST" action="{{ url_for('auth.addPermission') }}">
                            {{ form.csrf_token }}
                
                            <fieldset class="name">
                                {{ form.name.label }}
                                {{ form.name(placeholder='Access Admin Area') }}
                            </fieldset>
                            <div class="submit-button">
                                {{ form.submit }}
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script>
        $('document').ready(function(){
            var username = "{{current_user.username}}"
            var firstLetter = username.charAt(0)
            
            document.getElementById("user").innerHTML = firstLetter;
        });
    </script>
{{super()}}
{% endblock scripts %}